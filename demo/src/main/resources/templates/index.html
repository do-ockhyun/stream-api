<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>스트리밍 데모</title>
    <style>
        .message-container {
            margin: 20px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .message {
            margin: 10px 0;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 3px;
        }
        .timestamp {
            color: #666;
            font-size: 0.8em;
        }
    </style>
</head>
<body>
    <h1 th:text="${title}"></h1>
    
    <div class="message-container">
        <h2>수신된 메시지</h2>
        <div id="messages">
            <!-- 메시지가 여기에 동적으로 추가됩니다 -->
        </div>
    </div>

    <script>
        // SSE 연결 설정
        const eventSource = new EventSource('/api/messages');
        const messagesDiv = document.getElementById('messages');

        eventSource.onmessage = function(event) {
            const data = JSON.parse(event.data);
            
            // 새로운 메시지 요소 생성
            const messageElement = document.createElement('div');
            messageElement.className = 'message';
            messageElement.innerHTML = `
                <span class="timestamp">[${data.timestamp}]</span>
                <strong>ID ${data.id}:</strong> 
                <span>${data.message}</span>
            `;
            
            // 메시지를 컨테이너의 맨 위에 추가
            messagesDiv.insertBefore(messageElement, messagesDiv.firstChild);
        };

        eventSource.onerror = function(error) {
            console.error('SSE 에러:', error);
            eventSource.close();
        };
    </script>
</body>
</html>
